# Spring事务三大组件

## 1.PlateformTransationManger

> 定义Spring事务基本的操作方法，通过子类来实现
>
> 

## 2.TransactionDeinition

> 定义事物，描述事物的规则，如
>
> - 传播性
> - 是否只读
> - 隔离行
> - 超时时间
> - 回滚规则

## 3.TransactionStatus

> 事务本身，事务状态，可用通过此类查看当前事务是否是一个新的事务，判断事物是否存在



# 事务隔离级别

## 四大特性（ACID）

- 原子性，只能全部成功，或者全部失败
- 一致性，遵循业务逻辑的规则，如转账，一个账户转出100，另一个账户必定收到100
- 隔离性，事务与事务直接存在隔离，互不影响
- 持久性，即需改的数据会保存到磁盘中

## 隔离级别

- 读未提交，读不加锁，写加行级共享锁，事务1修改，事务2可以读取到，但是事务2不可以修改。
- 读已提交，读加共享锁，写加行级排他锁，直到事务结束，事务1修改，如果没有提交，事务2无法读取。
- 可重复读，读写多加排他锁，直到事务结束，所以其他事务不可读。
- 序列化，直接锁表

## 对应隔离级别产生的问题

- 赃读
- 不可重复读
- 幻读

> 读未提交无法解决赃读、不可重复读、幻读
>
> 读已提交可以解决赃读
>
> 可重复度可以几觉赃读和不可重复读
>
> 序列化可以解决所有问题，但是性能极差（Mysql的innoDB中可以通过MVCC在可重复度隔离级别下解决幻读问题）

# Spring事务的传播性
序号代表使用几率

| 传播性            | 描述                                                                |
|----------------|-------------------------------------------------------------------|
| 1.REQUIRED     | 如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务（默认）                            |
| SUPPORTS       | 如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行                             |
| MANDATORY      | 如果当前存在事务，则加入该事务，如果当前没有事务，则抛出异常                                    |
| 2.REQUIRES_NEW | 创建一个新的事务，如果当前存在事务，则把当前事务挂起                                        |
| NOT_SUPPORTED  | 以非事务方式运行，如果当前存在事务，则把当前事务挂起                                        |
| NEVER          | 以非事务方式运行，如果当前存在事务，则抛出异常                                           |
| 3.NESETD       | 当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行；如果当前没有事务，则该取值就是PROGPAGATION_REQUIRED |

